<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Dex.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Dex.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">95.56% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>43/45</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">83.33% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>35/42</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>16/16</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">94.29% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>66/70</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity 0.8.18;
&nbsp;
// Importing necessary OpenZeppelin contracts and interfaces
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
import "@openzeppelin/contracts/utils/structs/EnumerableSet.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/security/ReentrancyGuardUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
&nbsp;
// Importing necessary local interfaces
import "./interfaces/IERC20Burnable.sol";
import "./interfaces/IAccessManager.sol";
import "./interfaces/IBluumNft.sol";
import "./interfaces/IDex.sol";
&nbsp;
/**
 * @title Dex contract
 * @notice This contract allows for buying NFTs from different collections with different payment tokens.
 */
contract Dex is
    IDex,
    Initializable,
    UUPSUpgradeable,
    ReentrancyGuardUpgradeable
{
    using EnumerableSet for EnumerableSet.AddressSet;
    using SafeERC20 for IERC20Burnable;
&nbsp;
    IAccessManager public accessManager;
&nbsp;
    // Mapping: collection address =&gt; ID =&gt; payment token address =&gt; price
    mapping(address =&gt; mapping(uint256 =&gt; mapping(address =&gt; uint256)))
        private prices;
    // Mapping: collection address =&gt; payment tokens addresses
    mapping(address =&gt; EnumerableSet.AddressSet) private paymentTokens;
    // Mapping: payment token address =&gt; decimals
    mapping(address =&gt; uint256) private decimals;
    // Mapping: collection address =&gt; SKU =&gt; metadata
    mapping(address =&gt; mapping(uint256 =&gt; IBluumNft.Metadata)) private metadata;
    // Mapping: collection address =&gt; SKU =&gt; isAvailable
    mapping(address =&gt; mapping(uint256 =&gt; bool)) private isAvailable;
    // Set of collections addresses
    EnumerableSet.AddressSet private collections;
    // Address of the team wallet
    address private teamWallet;
&nbsp;
&nbsp;
    /**
     * @dev Contract initializer
     * @param _teamWallet The team wallet address
     * @param _accessManager Access Manager contract instance
     */
    function initialize(
        address _teamWallet,
        IAccessManager _accessManager
    ) public <span class="missing-if-branch" title="else path not taken" >E</span>initializer {
        // Revert if any of the addresses is zero address
        <span class="missing-if-branch" title="if path not taken" >I</span>if (
            _teamWallet == address(0) || address(_accessManager) == address(0)
        ) {
            revert ZeroAddress();
        }
        // Initializess the reentrancy guard
        __ReentrancyGuard_init();
        // Initializes the upgradeable contract
        __UUPSUpgradeable_init();
        // Settles the team wallet address
        teamWallet = _teamWallet;
        // Settles the team wallet address
        accessManager = _accessManager;
    }
&nbsp;
        /**
     * @notice Retrieves the payment tokens for a specific collection
     * @param _collection The collection address
     * @return _tokens An array of payment token addresses for the collection
     */
    function getPaymentTokens(
        address _collection
    ) external view returns (address[] memory _tokens) {
        _tokens = paymentTokens[_collection].values();
    }
&nbsp;
    /**
     * @notice Retrieves the metadata for specific tokens in a collection
     * @param _collection The collection address
     * @param _skuIDs An array of SKU IDs
     * @return _metadata An array of Metadata structs containing metadata for the tokens
     */
    function getNftsMetadata(
        address _collection,
        uint256[] calldata _skuIDs
    ) external view returns (IBluumNft.Metadata[] memory _metadata) {
        _metadata = new IBluumNft.Metadata[](_skuIDs.length);
        for (uint256 i = 0; i &lt; _skuIDs.length; ++i) {
            _metadata[i] = metadata[_collection][_skuIDs[i]];
        }
    }
&nbsp;
    /**
     * @notice Retrieves the price and decimal values for specific tokens in a collection
     * @param _collection The collection address
     * @param _sku The Sku ID
     * @param _tokens An array of payment token addresses
     * @return _prices An array of prices for the tokens
     * @return _decimals An array of decimal values for the tokens
     */
    function getPaymentTokenPrice(
        address _collection,
        uint256 _sku,
        address[] calldata _tokens
    )
        external
        view
        returns (uint256[] memory _prices, uint256[] memory _decimals)
    {
        _prices = new uint256[](_tokens.length);
        _decimals = new uint256[](_tokens.length);
        for (uint256 i = 0; i &lt; _tokens.length; ++i) {
            _prices[i] = prices[_collection][_sku][_tokens[i]];
            _decimals[i] = decimals[_tokens[i]];
        }
    }
&nbsp;
    /**
     * @notice Retrieves the available status for specific tokens in a collection
     * @param _collection The collection address
     * @param _skuIDs An array of SKU IDs
     * @return availableStatus An array of booleans indicating the available status of the tokens
     */
    function getAvailableStatus(
        address _collection,
        uint256[] calldata _skuIDs
    ) external view returns (bool[] memory availableStatus) {
        availableStatus = new bool[](_skuIDs.length);
        for (uint256 i = 0; i &lt; _skuIDs.length; ++i) {
            availableStatus[i] = isAvailable[_collection][_skuIDs[i]];
        }
    }   
&nbsp;
    /**
     * @notice Adds new collections to the dex
     * @dev Only admin can call this function
     * @param _collections An array of collection addresses to be added
     */
    function addCollections(
        address[] calldata _collections
    ) external onlyAdmin {
        for (uint256 i = 0; i &lt; _collections.length; ++i) {
            collections.add(_collections[i]);
            emit CollectionAdded(_collections[i]);
        }
    }
&nbsp;
    /**
     * @notice Removes collections from the dex
     * @dev Only admin can call this function
     * @param _collections An array of collection addresses to be removed
     */
    function removeCollections(
        address[] calldata _collections
    ) external onlyAdmin {
        for (uint256 i = 0; i &lt; _collections.length; ++i) {
            collections.remove(_collections[i]);
            emit CollectionRemoved(_collections[i]);
        }
    }
&nbsp;
    /**
     * @notice Sets the metadata for a specific token in a collection
     * @dev Only admin can call this function
     * @param _collection The collection address
     * @param _skuIDs An array of SKU IDs in the collection
     * @param _metadata An array of Metadata structs containing metadata for the tokens
     */
    function setMetadata(
        address _collection,
        uint256[] calldata _skuIDs,
        IBluumNft.Metadata[] calldata _metadata
    ) external onlyAdmin {
        for (uint256 i = 0; i &lt; _skuIDs.length; ++i) {
            metadata[_collection][_skuIDs[i]] = _metadata[i];
            emit MetadataSet(
                _collection,
                _skuIDs[i],
                _metadata[i].publicURI,
                _metadata[i].hashPrivateURI
            );
        }
    }
&nbsp;
    /**
     * @notice Sets the prices for specific tokens in a collection
     * @dev Only admin can call this function
     * @param _collection The collection address
     * @param _prices An array of Price structs containing payment tokens and corresponding prices
     * @param _skuIDs An array of SKU IDs in the collection
     */
    function setPrices(
        address _collection,
        Price[] calldata _prices,
        uint256[] calldata _skuIDs
    ) external onlyAdmin {
        for (uint256 i = 0; i &lt; _skuIDs.length; ++i) {
            for (uint256 j = 0; j &lt; _prices[i].paymentTokens.length; ++j) {
                address paymentToken = _prices[i].paymentTokens[j];
                <span class="missing-if-branch" title="if path not taken" >I</span>if(!paymentTokens[_collection].contains(paymentToken)) {
<span class="cstat-no" title="statement not covered" >                    paymentTokens[_collection].add(paymentToken)</span>;
<span class="cstat-no" title="statement not covered" >                    emit PaymentTokenAdded(_collection, paymentToken);</span>
                }
                <span class="missing-if-branch" title="if path not taken" >I</span>if (decimals[paymentToken] == 0) {
                    revert DecimalsNotSet(paymentToken);
                }
                prices[_collection][_skuIDs[i]][
                    paymentToken
                ] = _prices[i].prices[j];
                emit PriceSet(
                    _collection,
                    _skuIDs[i],
                    paymentToken,
                    _prices[i].prices[j]
                );
            }
        }
    }
&nbsp;
    /**
     * @notice Sets the available status for specific tokens in a collection
     * @dev Only admin can call this function
     * @param _collection The collection address
     * @param _skuIDs An array of SKU IDs in the collection
     * @param _isAvailable An array of booleans indicating the available status of the tokens
     */
    function setAvailableStatus(
        address _collection,
        uint256[] calldata _skuIDs,
        bool[] calldata _isAvailable
    ) external onlyAdmin {
        for (uint256 i = 0; i &lt; _skuIDs.length; ++i) {
            isAvailable[_collection][_skuIDs[i]] = _isAvailable[i];
            emit AvailableStatusSet(
                _collection,
                _skuIDs[i],
                _isAvailable[i]
            );
        }
    }
&nbsp;
    /**
     * @notice Adds payment tokens for a specific collection
     * @dev Only admin can call this function
     * @param _collection The collection address
     * @param _tokens An array of token addresses to be added as payment options
     */
    function addPaymentTokens(
        address _collection,
        address[] calldata _tokens
    ) external onlyAdmin {
        for (uint256 i = 0; i &lt; _tokens.length; ++i) {
            paymentTokens[_collection].add(_tokens[i]);
            emit PaymentTokenAdded(_collection, _tokens[i]);
        }
    }
&nbsp;
    /**
     * @notice Removes payment tokens for a specific collection
     * @dev Only admin can call this function
     * @param _collection The collection address
     * @param _tokens An array of token addresses to be removed from payment options
     */
    function removePaymentTokens(
        address _collection,
        address[] calldata _tokens
    ) external onlyAdmin {
        for (uint256 i = 0; i &lt; _tokens.length; ++i) {
            paymentTokens[_collection].remove(_tokens[i]);
            emit PaymentTokenRemoved(_collection, _tokens[i]);
        }
    }
&nbsp;
    /**
     * @notice Sets the decimal values for specific tokens
     * @dev Only admin can call this function
     * @param _tokens An array of token addresses
     * @param _decimals An array of decimal values corresponding to the tokens
     */
    function setDecimals(
        address[] calldata _tokens,
        uint256[] calldata _decimals
    ) external onlyAdmin {
        if (_tokens.length != _decimals.length) {
            revert TokensAndDecimalsLengthMismatch();
        }
        for (uint256 i = 0; i &lt; _tokens.length; ++i) {
            decimals[_tokens[i]] = _decimals[i];
            emit DecimalSet(_tokens[i], _decimals[i]);
        }
    }
&nbsp;
    /**
     * @notice Allows a user to buy an NFT from the dex
     * @param _paymentToken The payment token address
     * @param _collection The collection address
     * @param _sku The Sku ID
     */
    function buyNft(
        address _paymentToken,
        address _collection,
        uint256 _sku
    ) external <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant {
        // Reverts if the collection is not available
        if (!collections.contains(_collection)) {
            revert CollectionNotAvailable(_collection);
        }
        // Reverts if the payment token is not available
        if (!paymentTokens[_collection].contains(_paymentToken)) {
            revert PaymentTokenNotAvailable(_paymentToken);
        }
        // Reverts if the price is not set
        uint256 price = prices[_collection][_sku][_paymentToken];
        if (price == 0) {
            revert PriceMustBeGreaterThanZero();
        }
        // Reverts if the token is not available
        if (!isAvailable[_collection][_sku]) {
            revert TokenNotAvailable(_sku);
        }
&nbsp;
        // Secure the ID 
        isAvailable[_collection][_sku] = false;
&nbsp;
        // Transfers the payment token to the team wallet
        IERC20Burnable paymentToken = IERC20Burnable(_paymentToken);
        uint256 amount = price * (10 ** decimals[_paymentToken]);
        paymentToken.safeTransferFrom(msg.sender, teamWallet, amount);
&nbsp;
        // Mints the NFT
        IBluumNft nft = IBluumNft(_collection);
        uint256 tokenID = nft.mint(
            IBluumNft.MintInputData(
                msg.sender,
                metadata[_collection][_sku].publicURI,
                metadata[_collection][_sku].hashPrivateURI
            )   
        );
        emit NftBought(
            _collection,
            _sku,
            tokenID,
            _paymentToken,
            amount,
            msg.sender
        );
    }
&nbsp;
    /**
     * @dev Authorizes a contract upgrade
     * @param newImplementation The new contract address
     */
    function _authorizeUpgrade(
        address newImplementation
    ) internal override onlyAdmin {}
&nbsp;
    /**
     * @notice Checks if the caller is an admin
     */
    modifier onlyAdmin() {
        if (!accessManager.hasRole(keccak256("ADMIN_ROLE"), msg.sender)) {
            revert OnlyAdminCanCall(msg.sender);
        }
        _;
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Aug 04 2023 16:03:13 GMT+0200 (heure d’été d’Europe centrale)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
